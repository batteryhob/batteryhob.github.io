---
layout: post
title:  쿠버네티스에 GitOps도구 설치하기 (ArgoCD)
date:   2021-06-09 00:00:00 +0900
author: 전지호
tags: kubernetes helm gitops mlops
excerpt: 
use_math: false
toc: true
# tags: 자동 수집되는 태그 띄어쓰기로 구분, 반드시 소문자로 사용
# excerpt: 메인 화면에 노출되는 post의 description
# use_math : 수식이 필요 할 경우(윗 첨자, 아랫첨자 동시 사용 불가) true | false
# toc : 목차가 필요 할 경우 true | false
---


# 쿠버네티스에 GitOps 도구 설치하기

> 쿠버네티스에 도커 이미지를 자동 배포해주는 CI/CD를 구축해봅시다.

<br/>

## 개요

<hr/>

<br/>

## argo-cli 설치하기

<hr/>

> argocd의 명령어를 입력할 수 있는 cli(커맨드 라인 인터페이스) 설치해봅시다. 
>> 터미널에서 argocd의 명령어를 입력할 수 있게 해줍니다.

<br/>

## argoCD 설치

<hr/>

> 본격적으로 설치를 진행해봅니다.

kubectl 명령어를 이용하여, 클러스터에 설치가 가능한 노드가 있는지 확인합니다.

``` shell
kubectl get node
```

argocd가 설치될 네임스페이스를 생성해줍니다.

``` shell
kubectl create namespace argocd
```

생성한 네임스페이스에 공식 yaml을 이용해 가장 최신 버전으로 설치해줍시다.

``` shell
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
```

설치가 완료되었는 지 확인하려면, 다음 명령어를 통해 알 수 있습니다.

``` shell
kubectl get pod -n argocd
```

![<u>설치중</u>](https://solution-userstats.s3.ap-northeast-1.amazonaws.com/techblogs/batteryho/argocd/argocd%EC%84%A4%EC%B9%98%EC%A4%91.JPG)

![<u>설치완료</u>](https://solution-userstats.s3.ap-northeast-1.amazonaws.com/techblogs/batteryho/argocd/argocd%EC%84%A4%EC%B9%98%EC%99%84%EB%A3%8C.JPG)

<br/>

## argoCD 초기 설정

<hr/>

설치가 완료되었으면, 로드밸런서 설정을 통해 외부에서 접근이 가능하게 해야합니다.

아래 명령어는 linux명령어 이므로 windows라면 Gitbash에서 입력해주세요.

``` shell
kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'
```

![<u>외부접근</u>](https://solution-userstats.s3.ap-northeast-1.amazonaws.com/techblogs/batteryho/argocd/argocd%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%84%9C%EB%85%B8%EC%B6%9C.JPG)

로브밸런서 설정이 변경되었으면, 

로그인을 위해 랜덤 설정된 최초 비밀번호을 확인해봅시다.

참고로, 아이디는 `admin`으로 고정입니다.

아래 명령어는 linux명령어 이므로 windows라면 Gitbash에서 입력해주세요.

``` shell
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

![<u>최초 비밀번호 확인</u>](https://solution-userstats.s3.ap-northeast-1.amazonaws.com/techblogs/batteryho/argocd/argocd%EC%B5%9C%EC%B4%88%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8%EC%95%8C%EA%B8%B0.JPG)

이제 브라우저를 통해 접속해봅시다.

로드밸런서 설정이 완료되었다면, 호스트는 다음 명령어로 알 수 있습니다.

![<u>호스트 확인</u>](https://solution-userstats.s3.ap-northeast-1.amazonaws.com/techblogs/batteryho/argocd/argocd%ED%98%B8%EC%8A%A4%ED%8A%B8%EC%A3%BC%EC%86%8C%ED%99%95%EC%9D%B8.png)


<br/>

## 참고문헌

<hr/>

더 자세한 정보는 공식 가이드를 참조하세요.

👉 [<u>argo-cd guide</u>](https://argoproj.github.io/argo-cd/user-guide)